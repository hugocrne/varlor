# ------------------------------------------------------------
# üèóÔ∏è  BUILD STAGE
# ------------------------------------------------------------
FROM eclipse-temurin:17-jdk AS build
WORKDIR /app

# Copie des fichiers n√©cessaires √† Gradle
COPY ../../gateway/gradle gradle
COPY ../../gateway/gradlew .
COPY ../../gateway/build.gradle.kts .
COPY ../../gateway/settings.gradle.kts .
COPY ../../gateway/src src

# Build de l‚Äôapplication (fichier JAR)
RUN ./gradlew clean build -x test

# ------------------------------------------------------------
# üöÄ  RUNTIME STAGE
# ------------------------------------------------------------
FROM eclipse-temurin:17-jdk
WORKDIR /app

# Copie du jar g√©n√©r√© depuis le build pr√©c√©dent
COPY --from=build /app/build/libs/*.jar app.jar

# Port expos√© (par d√©faut 8080)
EXPOSE 8080

# Commande de d√©marrage
ENTRYPOINT ["java", "-jar", "app.jar"]